---
schema_version: 1
id: d5de980
status: open
blocked-by: []
created: 2026-01-04T22:07:28Z
type: feature
priority: 2
assignee: Calvin Alkan
---
# Configurable status workflow

Replace hardcoded statuses (open, in_progress, closed) with user-defined statuses organized into three categories (create, start, close) that map directly to commands.

## Overview

User-defined statuses in config, organized into three categories matching command names. Commands validate transitions and enforce workflow rules.

## Configuration

In `.tk/config.jsonc` (project) or global config:

```jsonc
{
  "statuses": {
    "create": ["triage", "spec_needed", "ready_for_plan"],
    "start": ["plan_in_progress", "plan_review", "ready_for_dev", "in_dev", "code_review"],
    "close": ["done", "canceled", "wont_fix"]
  }
}
```

### Default Configuration

When no `statuses` configured:

```jsonc
{
  "statuses": {
    "create": ["open"],
    "start": ["in_progress"],
    "close": ["done"]
  }
}
```

### Config Validation Rules

- Each category must have at least one status
- Status names must be unique across all categories
- Status names: lowercase alphanumeric + underscores
- All three categories required if `statuses` is present

## Commands

### `tk create <title>`

- Default status: first in `statuses.create`
- Optional `--status` flag must be in `create` category

### `tk start <id> <status>`

- `<status>` argument required
- Validates against `statuses.start`

### `tk close <id> <status>`

- `<status>` argument required
- Validates against `statuses.close`
- Validates no unresolved blockers

### `tk reopen <id> <status>`

- `<status>` argument required
- Validates against `statuses.start`

### `tk ls [--status=X]`

- Accepts any status (configured or unknown)
- Shows tickets with unknown statuses without error

### `tk ready`

- Returns tickets in `create` or `start` statuses
- Excludes `close` statuses and blocked tickets
- Excludes tickets with unknown statuses

## Validation Rules

### On Read (ticket files, cache)

- No validation - accept any status string
- Allows old tickets with legacy statuses to load

### On Write (create, start, close, reopen)

- Validate target status exists in appropriate category
- For `close`: validate no unresolved blockers

## Dynamic Help Messages

Help text must reflect configured statuses:

- `tk create --help` shows create statuses
- `tk start --help` shows start statuses
- `tk close --help` shows close statuses + blocker note
- `tk reopen --help` shows start statuses (reopen uses start category)
- `tk ls --help` shows all statuses + note: "Unknown statuses can also be used and filtered."

## Edge Cases

1. **Config changes with existing tickets**: Old tickets load fine, transition with valid target status
2. **Empty status argument**: Error with usage and valid options
3. **Close with blockers**: Error listing blocking ticket IDs
4. **Invalid config**: Immediate error before any command runs
5. **Unknown status in filter**: Works - filters tickets with that exact status
6. **Reopen non-closed ticket**: Allowed - just sets new status
7. **Start already-started ticket**: Allowed - moves within start category

## Acceptance Criteria

### Configuration

- [ ] `statuses` object with `create`, `start`, `close` keys recognized in config
- [ ] Each key contains array of status strings
- [ ] Status names validated: unique across categories, lowercase alphanumeric + underscores
- [ ] Missing `statuses` falls back to defaults: `open`, `in_progress`, `done`
- [ ] Empty category errors: `"statuses.X" must contain at least one status`
- [ ] Missing category errors: `"statuses.X" is required`
- [ ] Duplicate status errors: `duplicate status "X" in statuses.Y (already in statuses.Z)`
- [ ] Invalid name errors: `invalid status name "X": must be lowercase alphanumeric with underscores`
- [ ] Config errors halt execution before any command runs

### Command: `tk create`

- [ ] New tickets get first `create` status by default
- [ ] `--status` flag accepts any status in `create` category
- [ ] `--status` with non-create status errors with valid options listed
- [ ] Help shows available create statuses dynamically

### Command: `tk start`

- [ ] Requires `<id>` and `<status>` arguments
- [ ] Missing `<status>` shows usage and valid start statuses
- [ ] Validates `<status>` is in `start` category
- [ ] Invalid status shows error with valid options
- [ ] Updates ticket status on success
- [ ] Works regardless of current ticket status (known or unknown)
- [ ] Help shows available start statuses dynamically

### Command: `tk close`

- [ ] Requires `<id>` and `<status>` arguments
- [ ] Missing `<status>` shows usage and valid close statuses
- [ ] Validates `<status>` is in `close` category
- [ ] Invalid status shows error with valid options
- [ ] Validates ticket has no unresolved blockers
- [ ] Blocker error lists all blocking ticket IDs
- [ ] Updates ticket status on success (when no blockers)
- [ ] Works regardless of current ticket status (known or unknown)
- [ ] Help shows available close statuses dynamically
- [ ] Help mentions blocker restriction

### Command: `tk reopen`

- [ ] Requires `<id>` and `<status>` arguments
- [ ] Missing `<status>` shows usage and valid reopen statuses
- [ ] Validates `<status>` is in `start` category
- [ ] Invalid status shows error with valid options
- [ ] Updates ticket status on success
- [ ] Works regardless of current ticket status
- [ ] Help shows available reopen statuses dynamically (same as start)

### Command: `tk ls`

- [ ] `--status` filter accepts any configured status
- [ ] `--status` filter accepts unknown/legacy statuses
- [ ] Tickets with unknown statuses displayed without error
- [ ] Help shows all configured statuses
- [ ] Help includes note: "Unknown statuses can also be used and filtered."

### Command: `tk ready`

- [ ] Returns tickets in `create` or `start` statuses
- [ ] Excludes tickets in `close` statuses
- [ ] Excludes tickets with unresolved blockers
- [ ] Excludes tickets with unknown statuses (cannot determine category)

### Command: `tk show`

- [ ] Displays ticket regardless of status
- [ ] No validation on status field
- [ ] Unknown statuses displayed as-is

### Backward Compatibility

- [ ] Tickets with `open`, `in_progress`, `closed` statuses work with default config
- [ ] Tickets with unknown/legacy statuses load without error
- [ ] Tickets with unknown statuses appear in `tk ls`
- [ ] Tickets with unknown statuses can be transitioned using valid target status
- [ ] No migration required for existing tickets

### Help Text

- [ ] `tk --help` shows updated command signatures with `<status>` argument
- [ ] `tk create --help` shows create statuses
- [ ] `tk start --help` shows start statuses
- [ ] `tk close --help` shows close statuses and blocker note
- [ ] `tk reopen --help` shows reopen statuses (= start statuses)
- [ ] `tk ls --help` shows all statuses and unknown status note
- [ ] All status lists are dynamically generated from config

## File Changes Required

| File | Changes |
|------|---------|
| `config.go` | Add `Statuses` struct, parsing, validation, defaults |
| `ticket.go` | Remove hardcoded status validation on read |
| `create.go` | Use first `create` status as default, add `--status` flag with validation |
| `start.go` | Require status argument, validate against `start` category |
| `close.go` | Require status argument, validate against `close` category |
| `reopen.go` | Require status argument, validate against `start` category |
| `ls.go` | Accept any status in filter |
| `ready.go` | Filter by `create` + `start` categories, exclude unknown |
| `*_test.go` | Tests for all new behavior |
